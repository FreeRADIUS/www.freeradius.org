<HTML>
<head>
	<title>Acct-Session-Id Uniqueness</title>
	<link rel="stylesheet" type="text/css" href="/css/style.css" />
	<!--[if lt IE 7.]>
	<script defer type="text/javascript" src="/pngfix.js"></script>
	<![endif]-->
</head>
<BODY>

<!--#include file="/header.html" -->

<div id="content">

<H1>Acct-Session-Id Uniqueness</H1>

<p>This page discusses problems with standards and our recommended
solutions.  These recommendations do not update or modify any existing
standards.  However, we believe that the recommendations are generally
useful to the RADIUS community.</p>

<h2>Problem Statement</h2>

<p>The <code>Acct-Session-Id</code>
and <code>Acct-Multi-Session-Id</code> attributes are opaque tokens
generated by the NAS.  They are not required to be unique.  This means
that in practice, many NASes re-use the values across reboots.  For
example, on reboot, a NAS may start using values for Acct-Session-Id
at "000000", and increment them for every new user session.  As RFC
2866 notes, the IDs may even wrap.</p>

<p>Even worse, Section 5.5 of RFC 2866 begins <code>This attribute is
a unique Accounting ID...</code>, and then goes on to suggest that the
attribute is not, in fact, unique.</p>

<p>We believe that such behavior is problematic, and causes real-world
problems.</p>

<p>For example, since RADIUS is a UDP protocol, we can have the
following situation.  A user logs into a NAS, and is assigned
Acct-Session-Id of "000000" via an accounting "start", which the
RADIUS server receives and stores.  The NAS reboots a short while
later, and tries to send an accounting "on" packet to the server.  Due
to network issues, the server never receives this packet.  During this
time, the user reconnects, and is again
assigned <code>Acct-Session-Id</code> with value "000000", which the
RADIUS server recieves via an accounting "start".</p>

<p>This problem is a classic race condition.  The RADIUS server has
received two "start" packets, while it believes the NAS is alive.  The
RADIUS server is therefore required to believe that the two packets
are for the same session, when in fact they are for two different
sessions.  When the accounting "on" is subsequently received, the
RADIUS server will mark the session as offline.  It should instead
have marked the first session offline, and the second session as
continuing.</p>

<p>The problem becomes worse with TLS-based EAP methods.  Each user
may have the same value for the "outer" <code>User-Name</code>
attribute, e.g. "anonymous@example.com".  This re-use means that
sessions for multiple users may, in fact, appear to be all for one
"anonymous" user.  It may be possible to distinguish sessions via
other attributes, such as <code>Calling-Station-Id</code>, but MAC
addresses may be spoofed, and RFC 2866 has no guidelines for
determining which attributes identify "session".</p>

<p>There are many other failure conditions
for <code>Acct-Session-Id</code> re-use.  All of these failure
conditions result in problems for RADIUS server administrators.
Sessions may be marked stopped when they are actually ongoing,
sessions for multiple users may be confused, 

<p>FreeRADIUS works around this issue by creating
a <a href="http://freeradius.org/radiusd/man/rlm_acct_unique.txt">unique-Acct-Session-ID</a>
attribute.  This attribute is used internally and in the SQL schema,
but is not sent in any packet.</p>

<p>There is an RFC
Editor <a href="http://www.rfc-editor.org/errata_search.php?eid=4487">errata</a>
filed for this problem statement.</p>

<h2>Recommendations</h2>

<p>We have a number of recommendations.</p>

<ol>
<li>The values for <code>Acct-Session-Id</code> should be globally and temporally unique.</li>

<li>The values for <code>Acct-Multi-Session-Id</code> should be globally and temporally unique.</li>

</ul>

<p>One method of implementing these recommendations is to create
values for these attributes via a strong pseudo-random number
generator.  There are many such generators available for free on the
net.</p>

<p>As a related note, we recommend that the lengths of values for
these attributes be at least eight (8) characters, and no more than
sixty-four (64) characters.  Any less than eight may cause ID re-use.
And any more than sixty-four characters may cause inter-operatibility
problems with implementations that assume that the values
for <code>Acct-Session-Id</code> are short in length.

<p>The key thing to note here is that RFC 2866
treats <code>Acct-Session-Id</code> as a token generated by the NAS,
which has no meaning for any other entity in the RADIUS system.  That
is, for all parties, the <code>Acct-Session-Id</code> contains an
opaque token which can be tested for equality with other tokens.
However, the value of <code>Acct-Session-Id</code> cannot be
meaningfully split into sub-tokens.</p>

<p>This recommendation is therefore compatible with all existing
RADIUS systems, and requires no modifications to any system other than
the NAS which generates them.</p>

</div><!--content-->

<!--#include virtual="/footer.html" -->

</BODY></HTML>
